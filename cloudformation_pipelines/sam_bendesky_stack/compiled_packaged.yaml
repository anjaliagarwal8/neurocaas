Outputs:
  AccessKey3050ferralhogs:
    Description: 'Access Key of user: 3050ferralhogs in group bendeskylab'
    Value:
      Ref: userkey3050ferralhogs
  AccessKeyaln2128:
    Description: 'Access Key of user: aln2128 in group bendeskylab'
    Value:
      Ref: userkeyaln2128
  AccessKeycg3161:
    Description: 'Access Key of user: cg3161 in group bendeskylab'
    Value:
      Ref: userkeycg3161
  AccessKeyht2513:
    Description: 'Access Key of user: ht2513 in group bendeskylab'
    Value:
      Ref: userkeyht2513
  AccessKeykh2920:
    Description: 'Access Key of user: kh2920 in group bendeskylab'
    Value:
      Ref: userkeykh2920
  AccessKeynkw2113:
    Description: 'Access Key of user: nkw2113 in group bendeskylab'
    Value:
      Ref: userkeynkw2113
  AccessKeyps3121:
    Description: 'Access Key of user: ps3121 in group bendeskylab'
    Value:
      Ref: userkeyps3121
  Password3050ferralhogs:
    Description: Default password of new user 3050ferralhogs in group bendeskylab
    Value: b8e58f89912ac193
  Passwordaln2128:
    Description: Default password of new user aln2128 in group bendeskylab
    Value: 5102d843f11c8d6a
  Passwordcg3161:
    Description: Default password of new user cg3161 in group bendeskylab
    Value: 3e8654938d33a669
  Passwordht2513:
    Description: Default password of new user ht2513 in group bendeskylab
    Value: ce1e51a454950aeb
  Passwordkh2920:
    Description: Default password of new user kh2920 in group bendeskylab
    Value: 98fc2a2134a31b4f
  Passwordnkw2113:
    Description: Default password of new user nkw2113 in group bendeskylab
    Value: 0c9f750372fbadab
  Passwordps3121:
    Description: Default password of new user ps3121 in group bendeskylab
    Value: 2ea22ad4e6d2b98d
  SecretAccessKey3050ferralhogs:
    Description: 'Secret Key of new user: 3050ferralhogs in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkey3050ferralhogs
      - SecretAccessKey
  SecretAccessKeyaln2128:
    Description: 'Secret Key of new user: aln2128 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeyaln2128
      - SecretAccessKey
  SecretAccessKeycg3161:
    Description: 'Secret Key of new user: cg3161 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeycg3161
      - SecretAccessKey
  SecretAccessKeyht2513:
    Description: 'Secret Key of new user: ht2513 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeyht2513
      - SecretAccessKey
  SecretAccessKeykh2920:
    Description: 'Secret Key of new user: kh2920 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeykh2920
      - SecretAccessKey
  SecretAccessKeynkw2113:
    Description: 'Secret Key of new user: nkw2113 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeynkw2113
      - SecretAccessKey
  SecretAccessKeyps3121:
    Description: 'Secret Key of new user: ps3121 in group bendeskylab'
    Value:
      Fn::GetAtt:
      - userkeyps3121
      - SecretAccessKey
Resources:
  BaseFolderbendeskylab:
    DependsOn: PipelineMainBucket
    Properties:
      BucketName: bendeskymonitored
      DirName: bendeskylab
      Path: ''
      ServiceToken:
        Fn::GetAtt:
        - S3PutObjectFunction
        - Arn
    Type: AWS::CloudFormation::CustomResource
  CWPermissions:
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Ref: FigLambda
      Principal: events.amazonaws.com
    Type: AWS::Lambda::Permission
  CloudWatchBusRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action:
          - sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - events.amazonaws.com
        Version: '2012-10-17'
      ManagedPolicyArns:
      - Ref: CloudwatchBusPolicy
    Type: AWS::IAM::Role
  CloudwatchBusPolicy:
    Properties:
      Description:
        Fn::Join:
        - ' '
        - - Base Policy for all lambda function roles in
          - Ref: AWS::StackName
      PolicyDocument:
        Statement:
        - Action: events:*
          Effect: Allow
          Resource: '*'
          Sid: CloudWatchEventsFullAccess
        - Action: iam:PassRole
          Effect: Allow
          Resource: arn:aws:iam::*:role/AWS_Events_Invoke_Targets
          Sid: IAMPassRoleForCloudWatchEvents
        Version: '2012-10-17'
    Type: AWS::IAM::ManagedPolicy
  DeleteCustomResource:
    DependsOn: PipelineMainBucket
    Properties:
      BucketName: bendeskymonitored
      ServiceToken:
        Fn::GetAtt:
        - S3DelObjectFunction
        - Arn
    Type: AWS::CloudFormation::CustomResource
  FigLambda:
    Properties:
      CodeUri: s3://ctnsampackages/f2790eea1d3c1166e06fa10d9f065d46
      Description: Lambda Function logging start/stop for NCAP
      Events: {}
      Handler: log.eventshandler
      MemorySize: 128
      Role: arn:aws:iam::739988523141:role/lambda_dataflow
      Runtime: python3.6
      Timeout: 90
    Type: AWS::Serverless::Function
  FignameLogGroup:
    Properties:
      LogGroupName:
        Fn::Sub: /aws/lambda/${FigLambda}
    Type: AWS::Logs::LogGroup
  InFolderbendeskylab:
    DependsOn:
    - PipelineMainBucket
    - BaseFolderbendeskylab
    Properties:
      BucketName: bendeskymonitored
      DirName: inputs
      Path: bendeskylab/
      ServiceToken:
        Fn::GetAtt:
        - S3PutObjectFunction
        - Arn
    Type: AWS::CloudFormation::CustomResource
  LambdaBaseRole:
    Properties:
      Description:
        Fn::Join:
        - ' '
        - - Base Policy for all lambda function roles in
          - Ref: AWS::StackName
      PolicyDocument:
        Statement:
        - Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
          Effect: Allow
          Resource: arn:aws:logs:*:*:*
        Version: '2012-10-17'
    Type: AWS::IAM::ManagedPolicy
  LogFolderbendeskylab:
    DependsOn:
    - PipelineMainBucket
    - BaseFolderbendeskylab
    Properties:
      BucketName: bendeskymonitored
      DirName: logs
      Path: bendeskylab/
      ServiceToken:
        Fn::GetAtt:
        - S3PutObjectFunction
        - Arn
    Type: AWS::CloudFormation::CustomResource
  MainLambda:
    Properties:
      CodeUri: s3://ctnsampackages/1eedba26780992c91c98755aa37e96be
      Description: Main Lambda Function for Serverless
      Environment:
        Variables:
          AMI: ami-0a4f936b0b6fbd219
          COMMAND: ls; cd ../../../../home/ubuntu; bin/run.sh "{}" "{}" "{}"
          CONFIG: config.yaml
          EXECUTION_TIMEOUT: 180
          IAM_ROLE: pmd-s3-ssm
          INDIR: inputs
          INSTANCE_TYPE: p3.2xlarge
          KEY_NAME: ta_testkey
          LAUNCH: true
          LOGDIR: logs
          LOGFILE: lambda_log.txt
          MISSING_CONFIG_ERROR: We need a config file to analyze data.
          MONITOR: true
          OUTDIR: results
          REGION: us-east-1
          SECURITY_GROUPS: launch-wizard-34
          SHUTDOWN_BEHAVIOR: terminate
          SSM_TIMEOUT: 172000
          WORKING_DIRECTORY: ~/bin
          cwrolearn:
            Fn::GetAtt:
            - CloudWatchBusRole
            - Arn
          figlambarn:
            Fn::GetAtt:
            - FigLambda
            - Arn
          figlambid:
            Ref: FigLambda
      Events:
        BucketEventbendeskylab:
          Properties:
            Bucket:
              Ref: PipelineMainBucket
            Events:
            - s3:ObjectCreated:*
            Filter:
              S3Key:
                Rules:
                - Name: prefix
                  Value: bendeskylab/inputs
                - Name: suffix
                  Value: submit.json
          Type: S3
      Handler: submit_start.handler
      MemorySize: 128
      Role: arn:aws:iam::739988523141:role/lambda_dataflow
      Runtime: python3.6
      Timeout: 180
    Type: AWS::Serverless::Function
  OutFolderbendeskylab:
    DependsOn:
    - PipelineMainBucket
    - BaseFolderbendeskylab
    Properties:
      BucketName: bendeskymonitored
      DirName: results
      Path: bendeskylab/
      ServiceToken:
        Fn::GetAtt:
        - S3PutObjectFunction
        - Arn
    Type: AWS::CloudFormation::CustomResource
  PipelineMainBucket:
    Properties:
      AccessControl: Private
      BucketName: bendeskymonitored
    Type: AWS::S3::Bucket
  S3DelObjectFunction:
    Properties:
      CodeUri: s3://ctnsampackages/ff9f9d971319fc978822d261ba86e694
      Description: Deletes Objects from S3
      Environment:
        Variables:
          AMI: ami-0a4f936b0b6fbd219
          COMMAND: ls; cd ../../../../home/ubuntu; bin/run.sh "{}" "{}" "{}"
          CONFIG: config.yaml
          EXECUTION_TIMEOUT: 180
          IAM_ROLE: pmd-s3-ssm
          INDIR: inputs
          INSTANCE_TYPE: p3.2xlarge
          KEY_NAME: ta_testkey
          LAUNCH: true
          LOGDIR: logs
          LOGFILE: lambda_log.txt
          MISSING_CONFIG_ERROR: We need a config file to analyze data.
          MONITOR: true
          OUTDIR: results
          REGION: us-east-1
          SECURITY_GROUPS: launch-wizard-34
          SHUTDOWN_BEHAVIOR: terminate
          SSM_TIMEOUT: 172000
          WORKING_DIRECTORY: ~/bin
          cwrolearn:
            Fn::GetAtt:
            - CloudWatchBusRole
            - Arn
          figlambarn:
            Fn::GetAtt:
            - FigLambda
            - Arn
          figlambid:
            Ref: FigLambda
      Handler: helper.handler_deldir
      Role:
        Fn::GetAtt:
        - S3MakePathRole
        - Arn
      Runtime: python3.6
      Timeout: 30
    Type: AWS::Serverless::Function
  S3MakePathRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action:
          - sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - lambda.amazonaws.com
        Version: '2012-10-17'
      ManagedPolicyArns:
      - Ref: LambdaBaseRole
      Policies:
      - PolicyDocument:
          Statement:
          - Action:
            - s3:DeleteObject
            - s3:ListBucket
            - s3:PutObject
            Effect: Allow
            Resource: '*'
          Version: '2012-10-17'
        PolicyName: write_s3_policy
    Type: AWS::IAM::Role
  S3PutObjectFunction:
    Properties:
      CodeUri: s3://ctnsampackages/ea8db9835d3afd779d18db782d3fb1b7
      Description: Puts Objects in S3
      Environment:
        Variables:
          AMI: ami-0a4f936b0b6fbd219
          COMMAND: ls; cd ../../../../home/ubuntu; bin/run.sh "{}" "{}" "{}"
          CONFIG: config.yaml
          EXECUTION_TIMEOUT: 180
          IAM_ROLE: pmd-s3-ssm
          INDIR: inputs
          INSTANCE_TYPE: p3.2xlarge
          KEY_NAME: ta_testkey
          LAUNCH: true
          LOGDIR: logs
          LOGFILE: lambda_log.txt
          MISSING_CONFIG_ERROR: We need a config file to analyze data.
          MONITOR: true
          OUTDIR: results
          REGION: us-east-1
          SECURITY_GROUPS: launch-wizard-34
          SHUTDOWN_BEHAVIOR: terminate
          SSM_TIMEOUT: 172000
          WORKING_DIRECTORY: ~/bin
          cwrolearn:
            Fn::GetAtt:
            - CloudWatchBusRole
            - Arn
          figlambarn:
            Fn::GetAtt:
            - FigLambda
            - Arn
          figlambid:
            Ref: FigLambda
      Handler: helper.handler_mkdir
      Role:
        Fn::GetAtt:
        - S3MakePathRole
        - Arn
      Runtime: python3.6
      Timeout: 30
    Type: AWS::Serverless::Function
  UserGroupbendeskylab:
    Properties:
      GroupName: bendeskylabgroup
      Policies:
      - PolicyDocument:
          Statement:
          - Action: s3:GetBucketLocation
            Effect: Allow
            Resource: '*'
            Sid: VisualEditor0
          - Action: s3:HeadBucket
            Effect: Allow
            Resource: '*'
            Sid: VisualEditor3
          - Action: s3:ListAllMyBuckets
            Effect: Allow
            Resource: '*'
            Sid: VisualEditor1
          - Action: s3:ListBucket
            Condition:
              StringEquals:
                s3:delimiter:
                - /
                s3:prefix:
                - ''
                - bendeskylab/
                - bendeskylab/inputs
                - bendeskylab/results
                - bendeskylab/logs
                - bendeskylab/inputs/
                - bendeskylab/results/
                - bendeskylab/logs/
            Effect: Allow
            Resource:
            - arn:aws:s3:::bendeskymonitored
            Sid: ListBucket
          - Action:
            - s3:PutObject
            - s3:DeleteObject
            Effect: Allow
            Resource:
            - arn:aws:s3:::bendeskymonitored/bendeskylab/inputs/*
            Sid: Inputfolderwrite
          - Action:
            - s3:GetObject
            - s3:DeleteObject
            Effect: Allow
            Resource:
            - arn:aws:s3:::bendeskymonitored/bendeskylab/results/*
            - arn:aws:s3:::bendeskymonitored/bendeskylab/logs/*
            Sid: Outputfolderwrite
          Version: '2012-10-17'
        PolicyName: bendeskylabpolicy
    Type: AWS::IAM::Group
  bendeskylabUserNet:
    Properties:
      GroupName:
        Ref: UserGroupbendeskylab
      Users:
      - Ref: bendeskylabuser3050ferralhogs
      - Ref: bendeskylabuseraln2128
      - Ref: bendeskylabusernkw2113
      - Ref: bendeskylabusercg3161
      - Ref: bendeskylabuserkh2920
      - Ref: bendeskylabuserps3121
      - Ref: bendeskylabuserht2513
    Type: AWS::IAM::UserToGroupAddition
  bendeskylabuser3050ferralhogs:
    Properties:
      LoginProfile:
        Password: b8e58f89912ac193
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabuseraln2128:
    Properties:
      LoginProfile:
        Password: 5102d843f11c8d6a
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabusercg3161:
    Properties:
      LoginProfile:
        Password: 3e8654938d33a669
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabuserht2513:
    Properties:
      LoginProfile:
        Password: ce1e51a454950aeb
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabuserkh2920:
    Properties:
      LoginProfile:
        Password: 98fc2a2134a31b4f
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabusernkw2113:
    Properties:
      LoginProfile:
        Password: 0c9f750372fbadab
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  bendeskylabuserps3121:
    Properties:
      LoginProfile:
        Password: 2ea22ad4e6d2b98d
        PasswordResetRequired: 'false'
    Type: AWS::IAM::User
  userkey3050ferralhogs:
    Properties:
      UserName:
        Ref: bendeskylabuser3050ferralhogs
    Type: AWS::IAM::AccessKey
  userkeyaln2128:
    Properties:
      UserName:
        Ref: bendeskylabuseraln2128
    Type: AWS::IAM::AccessKey
  userkeycg3161:
    Properties:
      UserName:
        Ref: bendeskylabusercg3161
    Type: AWS::IAM::AccessKey
  userkeyht2513:
    Properties:
      UserName:
        Ref: bendeskylabuserht2513
    Type: AWS::IAM::AccessKey
  userkeykh2920:
    Properties:
      UserName:
        Ref: bendeskylabuserkh2920
    Type: AWS::IAM::AccessKey
  userkeynkw2113:
    Properties:
      UserName:
        Ref: bendeskylabusernkw2113
    Type: AWS::IAM::AccessKey
  userkeyps3121:
    Properties:
      UserName:
        Ref: bendeskylabuserps3121
    Type: AWS::IAM::AccessKey
Transform: AWS::Serverless-2016-10-31
